#!/usr/bin/env bash

# Claude Code for PMM - Unified Setup Script
# Auto-detects OS and runs the appropriate setup script

set -e

# Detect OS
if [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "cygwin" ]] || [[ "$OSTYPE" == "win32" ]]; then
    # Windows (Git Bash or Cygwin)
    echo "Detected Windows environment."
    echo ""
    
    # Check if PowerShell is available
    if command -v powershell.exe >/dev/null 2>&1; then
        echo "Running Windows setup script..."
        echo ""
        SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
        powershell.exe -ExecutionPolicy Bypass -File "$SCRIPT_DIR/setup.ps1"
    else
        echo "Error: PowerShell is not available."
        echo ""
        echo "Please run one of the following instead:"
        echo "  - setup.bat (from Command Prompt)"
        echo "  - .\\setup.ps1 (from PowerShell)"
        echo ""
        exit 1
    fi
elif [[ "$OSTYPE" == "darwin"* ]] || [[ "$OSTYPE" == "linux-gnu"* ]] || [[ "$OSTYPE" == "freebsd"* ]]; then
    # macOS or Linux
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    exec "$SCRIPT_DIR/setup.sh"
else
    echo "Unknown operating system: $OSTYPE"
    echo ""
    echo "Please run the appropriate setup script manually:"
    echo "  - Windows: setup.bat or .\\setup.ps1"
    echo "  - Mac/Linux: ./setup.sh"
    echo ""
    exit 1
fi
